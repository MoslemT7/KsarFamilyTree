[{"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\index.js":"1","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\App.js":"2","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\FamilyTree.js":"3","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\RelationChecker.js":"4","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\StatisticsDashboard.js":"5","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\SearchPage.js":"6","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\weddings.js":"7"},{"size":290,"mtime":1744565996798,"results":"8","hashOfConfig":"9"},{"size":2711,"mtime":1746312949606,"results":"10","hashOfConfig":"9"},{"size":7049,"mtime":1746059399454,"results":"11","hashOfConfig":"9"},{"size":27620,"mtime":1746498769333,"results":"12","hashOfConfig":"9"},{"size":41497,"mtime":1746463276931,"results":"13","hashOfConfig":"9"},{"size":27032,"mtime":1746315418831,"results":"14","hashOfConfig":"9"},{"size":2376,"mtime":1746312744973,"results":"15","hashOfConfig":"9"},{"filePath":"16","messages":"17","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"18"},"6rb0pv",{"filePath":"19","messages":"20","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"18"},{"filePath":"21","messages":"22","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"23","usedDeprecatedRules":"18"},{"filePath":"24","messages":"25","errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"26","messages":"27","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"28","messages":"29","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"30","usedDeprecatedRules":"18"},{"filePath":"31","messages":"32","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"18"},"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\index.js",[],["33","34"],"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\App.js",[],"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\FamilyTree.js",["35","36"],"import React, { useEffect, useState , useRef } from 'react';\r\nimport Tree from 'react-d3-tree';\r\nimport './FamilyTree.css';\r\nrequire('dotenv').config();\r\n\r\nconst translations = require('./translation.json');\r\n\r\nconst neo4jURI = process.env.REACT_APP_NEO4J_URI;\r\nconst neo4jUser = process.env.REACT_APP_NEO4J_USER;\r\nconst neo4jPassword = process.env.REACT_APP_NEO4J_PASSWORD;\r\n\r\nconst driver = require('neo4j-driver').driver(\r\n    neo4jURI,\r\n    require('neo4j-driver').auth.basic(neo4jUser, neo4jPassword)\r\n);\r\n\r\n\r\nconst session = driver.session();\r\n\r\nlet uniqueKeyCounter = 0;\r\nexport const translateName = (name) => {\r\n  return translations[name] || name;\r\n};\r\n\r\nconst renderFamilyTree = (person, parentId = null, level = 0) => {\r\n  const uniqueKey = `${person.name}-${person.lastName}-${parentId}-${level}-${uniqueKeyCounter++}`;\r\n\r\n  return (\r\n    <div key={uniqueKey}>\r\n      <div>\r\n        <strong>{person.name} {person.lastName}</strong>\r\n      </div>\r\n      {person.children && person.children.length > 0 && (\r\n        <div style={{ marginLeft: '20px' }}>\r\n          {person.children.map((child) => renderFamilyTree(child, person.id, level + 1))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst fetchFamilyTree = async () => {\r\n  try {\r\n    const response = await fetch('http://localhost:5000/api/family-tree');\r\n\r\n    if (!response.ok) {\r\n      throw new Error('Server error');\r\n    }\r\n\r\n    const data = await response.json(); // Parse JSON if response is valid\r\n    return data;\r\n  } catch (error) {\r\n    console.error('Error fetching family tree:', error.message);\r\n    return [];\r\n  }\r\n};\r\n\r\nconst formatFamilyTreeData = (person) => {\r\n  const children = person.children && person.children.length > 0\r\n    ? person.children.map(formatFamilyTreeData) // Recursively format children\r\n    : [];\r\n\r\n  return {\r\n    name: `${person.name} ${person.lastName}`,\r\n    children: children // Include children for each person\r\n  };\r\n};\r\n\r\nconst getChildrenOfFather = (fatherId, allPeople) => {\r\n  const father = allPeople.filter(father => father.id === fatherId)[0];  \r\n  return father && father.children ? father.children : [];  \r\n};\r\n\r\nconst buildTree = (person, allPeople) => {\r\n  if (!person) return null;\r\n\r\n  const children = getChildrenOfFather(person.id, allPeople)\r\n    .map(child => buildTree(child, allPeople))\r\n    .filter(Boolean); \r\n\r\n    \r\n    return {\r\n      id: person.id,\r\n      name: translateName(person.name),\r\n      children: children.length > 0 ? children : undefined,\r\n    };\r\n};\r\n\r\nconst getGenderbyID = async (personID) => {\r\n  const session = driver.session(); // Open a session\r\n\r\n  try {\r\n    // Fix the parameter name to match the query variable\r\n    const result = await session.run(\r\n      `MATCH (p:Person) WHERE id(p) = $personId \r\n      RETURN p.gender AS gender`,\r\n      { personId: personID } // Ensure the key matches the query's parameter\r\n    );\r\n    \r\n    if (result.records.length > 0) {\r\n      const gender = result.records[0].get('gender');\r\n      return gender; // Return the gender value\r\n    } else {\r\n      console.log(`No person found with the ID ${personID}`);\r\n      return null; // Return null when no person is found\r\n    }\r\n  } catch (error) {\r\n    console.error('Error retrieving gender:', error);\r\n    return null; // Return null in case of an error\r\n  } finally {\r\n    await session.close(); // Always close the session after the query\r\n  }\r\n};\r\n\r\nconst FamilyTree = ({ searchQuery }) => {\r\n  const treeContainerRef = useRef(null);\r\n  const [familyTree, setFamilyTree] = useState(null);\r\n  const [husbandId, setHusbandId] = useState(null);\r\n  const [translate, setTranslate] = useState({ x: 0, y: 0 });\r\n  const nodePositions = useRef({});\r\n\r\n  const handleWomanClick = async (person) => {\r\n    const gender = await getGenderbyID(person.id);\r\n    if (gender !== \"Female\") return;\r\n\r\n    try {\r\n      const result = await session.run(\r\n        `\r\n        MATCH (w:Person)-[:WIFE_OF]-(h:Person)\r\n        WHERE id(w) = $womanId\r\n        RETURN id(h) as HusbandID\r\n        LIMIT 1\r\n      `,\r\n        { womanId: person.id }\r\n      );\r\n\r\n      if (result.records.length > 0) {\r\n        const husband = result.records[0].get(\"HusbandID\").toNumber();\r\n        const coords = nodePositions.current[husband];\r\n        const container = treeContainerRef.current;\r\n\r\n        if (coords && container) {\r\n          const bounds = container.getBoundingClientRect();\r\n          setTranslate({\r\n            x: bounds.width / 2 - coords.x,\r\n            y: bounds.height / 2 - coords.y,\r\n          });\r\n        }\r\n\r\n        setHusbandId(husband);\r\n      } else {\r\n        console.log(\"No husband found for\", person.name);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching husband:\", error);\r\n    } finally {\r\n      await session.close();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const loadFamilyTree = async () => {\r\n      try {\r\n        const people = await fetchFamilyTree();\r\n        if (Array.isArray(people) && people.length > 0) {\r\n          const rootPerson = people.find((p) => p.id === 17); // ROOT\r\n          const treeData = buildTree(rootPerson, people);\r\n          setFamilyTree(treeData);\r\n        } else {\r\n          console.warn(\"Empty or invalid people data\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error loading family tree:\", error);\r\n      }\r\n    };\r\n\r\n    loadFamilyTree();\r\n  }, []);\r\n\r\n  if (!familyTree) return <div>Loading...</div>;\r\n  console.log(familyTree);\r\n  return (\r\n    <div\r\n      id=\"treeWrapper\"\r\n      ref={treeContainerRef}\r\n      style={{ width: \"100vw\", height: \"100vh\" }}\r\n    >\r\n      <Tree\r\n        data={familyTree}\r\n        orientation=\"vertical\"\r\n        pathFunc=\"step\"\r\n        translate={translate}\r\n        nodeSize={{ x: 100, y: 100 }} // Adjust node size if needed\r\n        separation={{ siblings: 1, nonSiblings: 2 }} // Adjust separation between nodes\r\n        renderCustomNodeElement={({ nodeDatum, hierarchyPointNode }) => {\r\n          const isHusband = nodeDatum.id === husbandId;\r\n\r\n          // Record node position\r\n          nodePositions.current[nodeDatum.id] = {\r\n            x: hierarchyPointNode.x,\r\n            y: hierarchyPointNode.y,\r\n          };\r\n\r\n          return (\r\n            <g\r\n              onClick={() => handleWomanClick(nodeDatum)}\r\n              style={{ cursor: \"pointer\" }}\r\n            >\r\n              <title>{nodeDatum.id}</title>\r\n              <rect\r\n                x=\"-50\"\r\n                y=\"-20\"\r\n                width=\"100\"\r\n                height=\"40\"\r\n                fill={isHusband ? \"lightgreen\" : \"#a8e6cf \"}\r\n                stroke=\"black\"\r\n                strokeWidth=\"2\"\r\n                rx=\"8\"\r\n              />\r\n              <text\r\n                x=\"0\"\r\n                y=\"5\"\r\n                fontSize=\"24\"\r\n                textAnchor=\"middle\"\r\n                fill=\"black\"\r\n              >\r\n                {nodeDatum.name}\r\n              </text>\r\n            </g>\r\n          );\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FamilyTree;","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\RelationChecker.js",["37","38","39","40","41","42","43"],"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\StatisticsDashboard.js",["44","45"],"D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\SearchPage.js",["46"],"import React, { useState } from 'react';\r\nimport \"./SearchPage.css\"\r\nimport Tree from 'react-d3-tree';\r\nconst translations = require('./translation.json');\r\nrequire('dotenv').config();\r\n\r\nconst neo4jURI = process.env.REACT_APP_NEO4J_URI;\r\nconst neo4jUser = process.env.REACT_APP_NEO4J_USER;\r\nconst neo4jPassword = process.env.REACT_APP_NEO4J_PASSWORD;\r\n\r\nconst driver = require('neo4j-driver').driver(\r\n    neo4jURI,\r\n    require('neo4j-driver').auth.basic(neo4jUser, neo4jPassword)\r\n);\r\n\r\nfunction countBenAndBent(str) {\r\n  const matches = str.match(/\\b(ben|bent)\\b/gi);\r\n  return matches ? matches.length : 0;\r\n}\r\n\r\nexport const translateName = (fullName, language = true) => {\r\n  const nameParts = fullName.split(' ');\r\n\r\nconst reverseTranslations = Object.fromEntries(\r\n  Object.entries(translations).map(([key, value]) => [value, key])\r\n);\r\n\r\n  const dict = language ? translations : reverseTranslations;\r\n\r\n  const translatedParts = nameParts.map(part => dict[part] || part);\r\n\r\n  return translatedParts.join(' ');\r\n};\r\n\r\nfunction splitName(fullName) {\r\n  const parts = fullName.replace(/\\s+(ben|bent)\\s+/gi, ' ').trim().split(/\\s+/);\r\n  const bentCount = countBenAndBent(fullName);\r\n  if (parts.length === 2) {\r\n    if (bentCount === 0){\r\n      return {\r\n        personName: parts[0],\r\n        fatherName: \"\",\r\n        grandfatherName: \"\",\r\n        familyName: parts[1]\r\n      };\r\n    }\r\n    else if (bentCount === 1){\r\n      return {\r\n        personName: parts[0],\r\n        fatherName: parts[1],\r\n        grandfatherName: \"\",\r\n        familyName: \"\"\r\n      };\r\n    }\r\n    \r\n  } \r\n  else if (parts.length === 3) {\r\n    if (bentCount === 1){\r\n      return {\r\n        personName: parts[0],\r\n        fatherName: parts[1],\r\n        grandfatherName: \"\",\r\n        familyName: parts[2]\r\n      };\r\n    }\r\n    else if (bentCount === 2){\r\n      return {\r\n        personName: parts[0],\r\n        fatherName: parts[1],\r\n        grandfatherName: parts[2],\r\n        familyName: \"\"\r\n      };\r\n    }\r\n    \r\n  } else if (parts.length === 4) {\r\n    return {\r\n      personName: parts[0],\r\n      fatherName: parts[1],\r\n      grandfatherName: parts[2],\r\n      familyName: parts[3]\r\n    };\r\n  }\r\n  // Default case if structure doesn't match\r\n  return { personName: parts[0], fatherName: \"\", grandfatherName: \"\", familyName: parts[1] };\r\n}\r\n\r\nconst SearchPage = () => {\r\n  const [treeVisible, setTreeVisible] = useState(false);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [personDetails, setPersonDetails] = useState(null);\r\n  const [treeData, setTreeData] = useState(null);\r\n  const [error, setError] = useState('');\r\n  \r\n  const getChildrenOfFather = async (fatherId) => {\r\n    const session = driver.session();\r\n    try {\r\n      const result = await session.run(\r\n        `\r\n        MATCH (father:Person)\r\n        WHERE id(father) = $fatherId\r\n        OPTIONAL MATCH (father)-[:FATHER_OF|MOTHER_OF]->(child:Person)\r\n        RETURN father, collect(child) AS children\r\n        `,\r\n        { fatherId }\r\n      );\r\n  \r\n      if (result.records.length > 0) {\r\n        const record = result.records[0];\r\n        const fatherNode = record.get('father');\r\n        const childrenNodes = record.get('children');\r\n  \r\n        const father = {\r\n          id: fatherNode.identity.toNumber(),\r\n          ...fatherNode.properties,\r\n        };\r\n  \r\n        const children = childrenNodes\r\n          .filter(child => child) // filter out nulls if no children\r\n          .map(child => ({\r\n            id: child.identity.toNumber(),\r\n            ...child.properties,\r\n          }));\r\n  \r\n        return { father, children };\r\n      } else {\r\n        return null;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching father and children:', error);\r\n      return null;\r\n    } finally {\r\n      await session.close();\r\n    }\r\n  };\r\n  \r\n  const handleShowChildren = async (e) => {\r\n    setTreeVisible(true);\r\n    e.stopPropagation();\r\n    const { father, children } = await getChildrenOfFather(personDetails.personID);\r\n  \r\n    // Transform into correct format for Tree component\r\n    const formattedData = {\r\n      id: father.id,\r\n      name: father.name,\r\n      children: children.map(child => ({\r\n        id: child.id,\r\n        name: child.name\r\n      }))\r\n    };\r\n  \r\n    setTreeData(formattedData);\r\n    \r\n  };\r\n\r\n  const handleSearchChange = (e) => {\r\n    setSearchQuery(e.target.value);\r\n  };\r\n\r\n  const handlePersonSelect = (selectedPerson) => {\r\n    setPersonDetails({\r\n      personID: selectedPerson.personID,\r\n      personName: selectedPerson.personName,\r\n      fatherName: selectedPerson.fatherName,\r\n      grandfatherName: selectedPerson.grandfatherName,\r\n      familyName: selectedPerson.familyName,\r\n      gender: selectedPerson.gender,\r\n      age: selectedPerson.age,\r\n      YoD: selectedPerson.YoD,\r\n      motherName: selectedPerson.motherName,\r\n      motherFatherName: selectedPerson.motherFatherName,\r\n      motherGrandFatherName: selectedPerson.motherGrandFatherName,\r\n      motherFamilyName: selectedPerson.motherFamilyName,\r\n      lifeStatus: selectedPerson.lifeStatus,\r\n      martialStatus: selectedPerson.martialStatus,\r\n      childrenCount: selectedPerson.childrenCount,\r\n    });\r\n  };\r\n\r\n  const handleSearchSubmit = async () => {\r\n    setTreeVisible(false);\r\n    if (!searchQuery.trim()) {\r\n      setError('الرجاء إدخال نص للبحث.');\r\n      setPersonDetails(null);\r\n      return;\r\n    }\r\n    await searchPerson(searchQuery.trim());\r\n  };\r\n\r\n  const searchPerson = async (searchText) => {\r\n    let translatedInputName = translateName(searchText, false);\r\n    console.log(translatedInputName);\r\n    const { personName, fatherName, grandfatherName, familyName } = splitName(translatedInputName);\r\n\r\n    let cypherQuery = ``;\r\n    const queryParamsObject = {};\r\n\r\n    if (personName){\r\n      \r\n      if (fatherName) {\r\n        \r\n        if (grandfatherName) {\r\n          \r\n          if (familyName) {\r\n            \r\n            cypherQuery += `\r\n              MATCH (grandfather:Person)-[:FATHER_OF]->(father:Person)-[:FATHER_OF]->(child:Person)\r\n              WHERE child.name = $personName AND \r\n                    father.name = $fatherName AND \r\n                    grandfather.name = $grandfatherName AND \r\n                    child.lastName = $familyName\r\n              RETURN child.name AS childName, father.name AS fatherName, grandfather.name AS grandfatherName, child.lastName AS familyName,  \r\n              child.YoB AS childYoB, child.gender AS childGender, id(child) AS childID,\r\n              child.isAlive AS lifeStatus, child.YoD AS YoD\r\n            `;\r\n            \r\n            queryParamsObject.personName = personName;\r\n            queryParamsObject.fatherName = fatherName;\r\n            queryParamsObject.grandfatherName = grandfatherName;\r\n            queryParamsObject.familyName = familyName;\r\n            \r\n          } \r\n          else {\r\n            cypherQuery += `\r\n              MATCH (grandfather:Person)-[:FATHER_OF]->(father:Person)-[:FATHER_OF]->(child:Person)\r\n              WHERE child.name = $personName AND \r\n                    father.name = $fatherName AND \r\n                    grandfather.name = $grandfatherName\r\n              RETURN child.name AS childName, father.name AS fatherName, grandfather.name AS grandfatherName, \r\n              child.YoB AS childYoB, child.gender AS childGender, id(child) AS childID, child.isAlive AS lifeStatus, child.YoD AS YoD`;\r\n            \r\n            queryParamsObject.personName = personName;\r\n            queryParamsObject.fatherName = fatherName;\r\n            queryParamsObject.grandfatherName = grandfatherName;\r\n          }\r\n          \r\n        } else {\r\n          if (familyName){\r\n            cypherQuery += `\r\n            MATCH (father:Person)-[:FATHER_OF]->(child:Person)\r\n            WHERE child.name = $personName AND \r\n                  father.name = $fatherName AND\r\n                  child.lastName = $familyName\r\n            OPTIONAL MATCH (grandfather:Person)-[:FATHER_OF]->(father)\r\n            RETURN child.name AS childName, \r\n                  father.name AS fatherName,\r\n                  grandfather.name as grandfatherName,\r\n                  child.lastName AS familyName,\r\n                  child.YoB AS childYoB, \r\n                  child.gender AS childGender, \r\n                  id(child) AS childID,\r\n                  child.isAlive AS lifeStatus, \r\n                  child.YoD AS YoD\r\n            `;\r\n            queryParamsObject.personName = personName;\r\n            queryParamsObject.fatherName = fatherName;\r\n            queryParamsObject.familyName = familyName;\r\n          }\r\n          else{\r\n            cypherQuery += `\r\n            MATCH (father:Person)-[:FATHER_OF]->(child:Person)\r\n            \r\n            WHERE child.name = $personName AND \r\n                  father.name = $fatherName\r\n            OPTIONAL MATCH (grandfather:Person)-[:FATHER_OF]->(father)\r\n            RETURN child.name AS childName, \r\n                   father.name AS fatherName, \r\n                   grandfather.name as grandfatherName,\r\n                   child.lastName AS familyName,\r\n                   child.YoB AS childYoB, \r\n                   child.gender AS childGender, \r\n                   id(child) AS childID, \r\n                   child.isAlive AS lifeStatus,\r\n                   child.YoD AS YoD\r\n            `;\r\n            queryParamsObject.personName = personName;\r\n            queryParamsObject.fatherName = fatherName;\r\n          }\r\n          }\r\n      }\r\n      else {\r\n        if (familyName){\r\n          cypherQuery += `\r\n          MATCH (child:Person)\r\n          WHERE child.name = $personName AND child.lastName = $familyName\r\n          OPTIONAL MATCH (father:Person)-[:FATHER_OF]->(child)\r\n          OPTIONAL MATCH (grandfather:Person)-[:FATHER_OF]->(father)\r\n          RETURN \r\n            child.name AS childName, \r\n            father.name AS fatherName,\r\n            grandfather.name AS grandfatherName,\r\n            child.lastName AS familyName,\r\n            child.YoB AS childYoB, \r\n            child.gender AS childGender, \r\n            id(child) AS childID,\r\n            child.isAlive AS lifeStatus,\r\n            child.YoD AS YoD\r\n        `;\r\n        queryParamsObject.personName = personName;\r\n        queryParamsObject.familyName = familyName;\r\n        }\r\n        else{\r\n          cypherQuery += `\r\n            MATCH (child:Person)\r\n            WHERE child.name = $personName\r\n            OPTIONAL MATCH (father:Person)-[:FATHER_OF]->(child)\r\n            OPTIONAL MATCH (grandfather:Person)-[:FATHER_OF]->(father)\r\n            RETURN child.name AS childName, \r\n                  child.YoB AS childYoB, \r\n                  child.gender AS childGender,\r\n                  father.name AS fatherName, \r\n                  grandfather.name AS grandfatherName,\r\n                   child.lastName AS familyName,\r\n                  id(child) AS childID,\r\n                  child.isAlive AS lifeStatus,\r\n                  child.YoD AS YoD\r\n\r\n          `;\r\n          queryParamsObject.personName = personName;\r\n        }\r\n      }\r\n    }\r\n    \r\n    const session = driver.session();\r\n    try {\r\n      const result = await session.run(cypherQuery, queryParamsObject);\r\n      if (result.records.length === 0) {\r\n        setError('هذا الشخص ليس مسجل في الشجرة ، الرجاء التحقق من الإسم.');\r\n        setPersonDetails(null);\r\n        return;\r\n      }\r\n      else if (result.records.length === 1) {\r\n        const record = result.records[0];\r\n        let age;\r\n        let YoB = record.get('childYoB');\r\n        let YoD = record.get('YoD');\r\n        if (YoB == null){\r\n          age = -1;\r\n        }\r\n        else{\r\n          age = new Date().getFullYear() - YoB;\r\n        }\r\n        \r\n        const childID = record.get(\"childID\").toNumber();\r\n\r\n        const motherQuery = await session.run(`\r\n          OPTIONAL MATCH (mother:Person)-[:MOTHER_OF]->(child:Person)\r\n          WHERE id(child) = $childID\r\n          OPTIONAL MATCH (motherFather)-[:FATHER_OF]->(mother:Person)\r\n          OPTIONAL MATCH (motherGrandFather)-[:FATHER_OF]->(motherFather:Person)\r\n          RETURN \r\n            mother.name AS motherName,\r\n            motherFather.name AS motherFatherName,\r\n            motherGrandFather.name AS motherGrandFatherName,\r\n            mother.lastName AS motherFamilyName\r\n        `, {childID});\r\n        const motherResult = motherQuery.records[0];\r\n\r\n        const childrenCountRecord = await session.run(`\r\n          MATCH (p:Person)-[:FATHER_OF|MOTHER_OF]->(child:Person)\r\n          WHERE id(p) = $childID\r\n          RETURN count(child) AS childrenCount\r\n        `, { childID });\r\n\r\n        const siblingsCountsRecord = await session.run(`\r\n        MATCH (target:Person)\r\n        WHERE id(target) = 23\r\n        MATCH (parent:Person)-[:FATHER_OF|MOTHER_OF]->(target)\r\n        MATCH (parent)-[:FATHER_OF|MOTHER_OF]->(sibling:Person)\r\n        WHERE id(sibling) <> 23\r\n\r\n        RETURN count(DISTINCT sibling) AS siblingCount  \r\n        `, {childID});\r\n        const isMarried = await session.run(`\r\n          MATCH (p)-[:HUSBAND_OF|WIFE_OF]->(:Person)\r\n          WHERE id(p) = $childID\r\n          RETURN count(*) > 0 AS isMarried\r\n        `, { childID });\r\n        const personDetails = {\r\n          personID: childID,\r\n          personName: record.get('childName') ?? \"غير متوفر\",\r\n          fatherName: record.has('fatherName') ? record.get('fatherName') : \"غير متوفر\",\r\n          grandfatherName: record.has('grandfatherName') ? record.get('grandfatherName') : \"غير متوفر\", \r\n          familyName: record.has('familyName') ? record.get('familyName') : \"غير متوفر\", \r\n          gender: record.has('childGender') ? record.get('childGender') : \"غير متوفر\", \r\n          age,\r\n          YoD: YoD,\r\n          motherName: motherResult.has('motherName') ? motherResult.get('motherName') : \"غير متوفر\", \r\n          motherFatherName: motherResult.has('motherFatherName') ? motherResult.get('motherFatherName') : \"غير متوفر\", // Check if motherFatherName exists\r\n          motherGrandFatherName: motherResult.has('motherGrandFatherName') ? motherResult.get('motherGrandFatherName') : \"غير متوفر\", // Check if motherGrandfatherName exists\r\n          motherFamilyName: motherResult.has('motherFamilyName') ? motherResult.get('motherFamilyName') : \"غير متوفر\", // Check if motherFamilyName exists\r\n          \r\n          lifeStatus: record.has('lifeStatus') ? record.get('lifeStatus') : \"غير متوفر\", // Check if lifeStatus exists\r\n          martialStatus: isMarried.records[0]?.get('isMarried') ?? \"غير متوفر\", // Safe access for marital status\r\n          childrenCount: childrenCountRecord.records[0]?.get('childrenCount')?.toInt() ?? 0, // Default to 0 if missing\r\n          siblingsCountsRecord: siblingsCountsRecord.records[0]?.get('siblingCount')?.toInt() ?? 0\r\n        };\r\n    \r\n        setPersonDetails(personDetails);\r\n        setError('');\r\n    \r\n      } \r\n      else if (result.records.length >= 2) {\r\n        const multipleMatches = [];\r\n      \r\n        for (const record of result.records) {\r\n          let age;\r\n          let YoB = record.get('childYoB');\r\n          let YoD = record.get('YoD');\r\n      \r\n          if (YoB == null) {\r\n            age = -1;\r\n          } else {\r\n            age = new Date().getFullYear() - YoB;\r\n          }\r\n      \r\n          const childID = record.get(\"childID\").toNumber();\r\n      \r\n          const motherQuery = await session.run(`\r\n            MATCH (child:Person) WHERE id(child) = $childID\r\n            OPTIONAL MATCH (mother:Person)-[:MOTHER_OF]->(child)\r\n            OPTIONAL MATCH (motherFather:Person)-[:FATHER_OF]->(mother)\r\n            OPTIONAL MATCH (motherGrandFather:Person)-[:FATHER_OF]->(motherFather)\r\n            RETURN \r\n              mother.name AS motherName,\r\n              motherFather.name AS motherFatherName,\r\n              motherGrandFather.name AS motherGrandFatherName,\r\n              mother.lastName AS motherFamilyName\r\n          `, { childID });\r\n      \r\n          const motherResult = motherQuery.records[0] ?? null;\r\n          const childrenCountRecord = await session.run(`\r\n            MATCH (p:Person)-[:FATHER_OF|MOTHER_OF]->(child:Person)\r\n            WHERE id(p) = $childID\r\n            RETURN count(child) AS childrenCount\r\n          `, { childID });\r\n      \r\n          const isMarried = await session.run(`\r\n            MATCH (m:Person)-[r:HUSBAND_OF]->(w:Person)\r\n            WHERE id(m) = $childID\r\n            RETURN count(r) > 0 AS isMarried\r\n          `, { childID });\r\n      \r\n          const personDetails = {\r\n            personID: childID,\r\n            personName: record.get('childName') ?? \"غير متوفر\",\r\n            fatherName: record.has('fatherName') ? record.get('fatherName') : \"غير متوفر\",\r\n            grandfatherName: record.has('grandfatherName') ? record.get('grandfatherName') : \"غير متوفر\",\r\n            familyName: record.has('familyName') ? record.get('familyName') : \"غير متوفر\",\r\n            gender: record.has('childGender') ? record.get('childGender') : \"غير متوفر\",\r\n            age,\r\n            YoD,\r\n            motherName: motherResult?.get('motherName') ?? \"غير متوفر\",\r\n            motherFatherName: motherResult?.get('motherFatherName') ?? \"غير متوفر\",\r\n            motherGrandFatherName: motherResult?.get('motherGrandFatherName') ?? \"غير متوفر\",\r\n            motherFamilyName: motherResult?.get('motherFamilyName') ?? \"غير متوفر\",\r\n\r\n            lifeStatus: record.has('lifeStatus') ? record.get('lifeStatus') : \"غير متوفر\",\r\n            martialStatus: isMarried.records[0]?.get('isMarried') ?? \"غير متوفر\",\r\n            childrenCount: childrenCountRecord.records[0]?.get('childrenCount')?.toInt() ?? 0\r\n          };\r\n      \r\n          multipleMatches.push(personDetails);\r\n        }\r\n      \r\n        setPersonDetails({ multipleMatches });\r\n        setError('هناك العديد من الأشخاص يحملون نفس الاسم. الرجاء اختيار الشخص الصحيح.');\r\n      }\r\n       else {\r\n        setPersonDetails(null);\r\n        setError('لم يتم العثور على شخص مطابق.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Query Error:', err);\r\n      setError('حدث خطأ أثناء البحث.');\r\n      setPersonDetails(null);\r\n    } finally {\r\n      await session.close();\r\n    }\r\n    \r\n  };\r\n\r\n  return (\r\n    <div className=\"search-page\">\r\n      <header className=\"search-header\">\r\n        <h1>ابحث عن شخص في شجرة العائلة</h1>\r\n        <input\r\n          type=\"text\"\r\n          className=\"search-bar\"\r\n          placeholder=\"ادخل الاسم الثلاثي أو الرباعي...\"\r\n          value={searchQuery}\r\n          onChange={handleSearchChange}\r\n        />\r\n        <button className=\"search-button\" onClick={handleSearchSubmit}>ابحث</button>\r\n      </header>\r\n\r\n      {error && <div className=\"error-message\">{error}</div>}\r\n\r\n      {personDetails && personDetails.multipleMatches ? (\r\n  <div className=\"multiple-matches\">\r\n    <h2>نتائج متعددة:</h2>\r\n    {personDetails.multipleMatches.map((person, index) => (\r\n      <div \r\n        key={index} \r\n        className=\"match-item\"\r\n        onClick={() => handlePersonSelect(person)}\r\n        style={{ cursor: 'pointer' }}\r\n      >\r\n       <p className='dupPersonName'>{index + 1}- {translateName(person.personName)} بن {translateName(person.fatherName)} بن {translateName(person.grandfatherName)} {translateName(person.familyName)}</p>\r\n        <hr />\r\n      </div>\r\n    ))}\r\n  </div>\r\n) : personDetails ? (\r\n  <div className=\"person-details\">\r\n    <h2>تفاصيل الشخص :</h2>\r\n    <h3>\r\n      {translateName(personDetails?.personName ?? \"غير معروف\")}\r\n      {personDetails?.fatherName\r\n        ? ` ${personDetails.gender === 'Female' ? 'بنت' : 'بن'} ${translateName(personDetails.fatherName)}`\r\n        : ''}\r\n      {personDetails?.grandfatherName\r\n        ? ` بن ${translateName(personDetails.grandfatherName)}`\r\n        : ''}\r\n      {personDetails?.familyName\r\n        ? ` ${translateName(personDetails.familyName)}`\r\n        : ''}\r\n    </h3>\r\n    <table className=\"person-details-table\">\r\n      <thead>\r\n        <tr>\r\n          <th className='blankHeader'></th>\r\n          <th>الإسم</th>\r\n          <th>إسم الأب</th>\r\n          <th>إسم الجّد</th>\r\n          <th>إسم العائلة / اللقب</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr>\r\n          <td><strong>الشخص</strong></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.personName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.fatherName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.grandfatherName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.familyName ?? '') || 'غير متوفر'}</p></td>\r\n        </tr>\r\n        <tr>\r\n          <td><strong>الأم</strong></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.motherName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.motherFatherName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.motherGrandFatherName ?? '') || 'غير متوفر'}</p></td>\r\n          <td><p className='personDetails'>{translateName(personDetails?.motherFamilyName ?? '') || 'غير متوفر'}</p></td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <table className=\"person-details2-table\">\r\n      <thead>\r\n        <tr>\r\n          <th>الجنس</th>\r\n          <th>العمر</th>\r\n          <th>الحالة المدنية</th>\r\n          <th>حالة الحياة</th>\r\n          <th>عدد الأطفال</th>\r\n          <th>عدد الإخوة</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr>\r\n          <td>{personDetails.gender === 'Male' ? 'ذكر 👨'  : 'أنثى 👩'}</td>\r\n          <td\r\n            dangerouslySetInnerHTML={{\r\n              __html: personDetails.lifeStatus === true\r\n                ? personDetails.age !== -1\r\n                  ? personDetails.age === 1\r\n                    ? `سنة واحدة (مواليد ${new Date().getFullYear() - personDetails.age})`\r\n                    : personDetails.age === 2\r\n                    ? `سنتان (مواليد ${new Date().getFullYear() - personDetails.age})`\r\n                    : personDetails.age >= 3 && personDetails.age <= 10\r\n                    ? `${personDetails.age} سنوات (مواليد ${new Date().getFullYear() - personDetails.age})`\r\n                    : `${personDetails.age} سنة (مواليد ${new Date().getFullYear() - personDetails.age})`\r\n                  : 'العمر غير معروف'\r\n                : personDetails.hasOwnProperty('YoD') && personDetails.YoD\r\n                ? personDetails.age !== -1\r\n                  ? `مواليد سنة ${new Date().getFullYear() - personDetails.age} <br /> \r\n                      عاش ${personDetails.YoD - (new Date().getFullYear() - personDetails.age)} سنة <br /> \r\n                      توفي في ${personDetails.YoD}`\r\n                  : `مواليد ${new Date().getFullYear() - personDetails.age} <br /> \r\n                      توفي في سنة ${personDetails.YoD}`\r\n                : personDetails.hasOwnProperty('YoB') && personDetails.YoB\r\n                ? `مواليد ${personDetails.YoB} <br /> العمر غير معروف`\r\n                : 'غير متوفر'\r\n            }}\r\n          />\r\n\r\n          <td>\r\n            {personDetails.lifeStatus === true\r\n              ? personDetails.martialStatus === true\r\n                ? personDetails.gender === 'Male'\r\n                  ? 'متزوج'\r\n                  : 'متزوجة'\r\n                : personDetails.gender === 'Male'\r\n                ? 'أعزب'\r\n                : 'عزباء'\r\n              : '-'}\r\n          </td>\r\n          <td>\r\n          {personDetails.lifeStatus === true \r\n            ? (personDetails.gender === 'Male' ? 'حي' : 'حية') \r\n            : (personDetails.gender === 'Male' ? 'متوفى' : 'متوفية')}\r\n          </td>\r\n        <td>\r\n        <button id='childrenButton' \r\n        onClick={handleShowChildren}>\r\n          {personDetails.childrenCount === 0 || personDetails.childrenCount == null\r\n            ? 'ليس لديه أطفال'\r\n            : personDetails.childrenCount === 1\r\n            ? 'طفل واحد'\r\n            : personDetails.childrenCount === 2\r\n            ? 'طفلان'\r\n            : personDetails.childrenCount >= 3 && personDetails.childrenCount <= 10\r\n            ? `${personDetails.childrenCount} أطفال`\r\n            : `${personDetails.childrenCount} طفلا`\r\n          }\r\n        </button>\r\n        \r\n      </td>\r\n      <td>\r\n        {personDetails.siblingsCountsRecord === 0 || personDetails.siblingsCountsRecord == null\r\n          ? 'ليس لديه إخوة'\r\n          : personDetails.siblingsCountsRecord === 1\r\n          ? `أخٌ واحدٌ (${2})`\r\n          : personDetails.siblingsCountsRecord === 2\r\n          ? `أخوان (${2})`\r\n          : personDetails.siblingsCountsRecord >= 3 && personDetails.siblingsCountsRecord <= 10\r\n          ? `${personDetails.siblingsCountsRecord} إخوة`\r\n          : `${personDetails.siblingsCountsRecord} أخا`}\r\n      </td>\r\n\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <div className=\"tree-wrapper\">\r\n        <div className='titleTree'>\r\n\r\n        </div>\r\n      \r\n      {treeData && (\r\n        <div className=\"tree-container\">\r\n          <Tree\r\n            data={treeData}\r\n            orientation=\"vertical\"\r\n            pathFunc=\"step\"\r\n            nodeSize={{ x: 60, y: 100 }}\r\n            separation={{ siblings: 2, nonSiblings: 2 }}\r\n            translate={{ x: 325, y: 27 }} \r\n            scaleExtent={{ min: 1, max: 1 }} // Disable zooming\r\n            renderCustomNodeElement={({ nodeDatum }) => (\r\n              <g className=\"tree-node\">\r\n                <title>{nodeDatum.id}</title>\r\n                <rect\r\n                  className=\"tree-node-rect\"\r\n                  x=\"-50\"\r\n                  y=\"-20\"\r\n                  width=\"100\"\r\n                  height=\"40\"\r\n                />\r\n                <text className=\"tree-node-text\" x=\"0\" y=\"5\">\r\n                  {translateName(nodeDatum.name)}\r\n                </text>\r\n              </g>\r\n            )}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n\r\n  </div>\r\n) : (\r\n  <div className=\"no-results\">\r\n    <p>لا توجد نتائج للبحث.</p>\r\n  </div>\r\n)}\r\n  <div>\r\n    \r\n  </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SearchPage;\r\n\r\n","D:\\Study\\Projects\\El-Kasr Family Tree\\client\\src\\components\\weddings.js",[],{"ruleId":"47","replacedBy":"48"},{"ruleId":"49","replacedBy":"50"},{"ruleId":"51","severity":1,"message":"52","line":25,"column":7,"nodeType":"53","messageId":"54","endLine":25,"endColumn":23},{"ruleId":"51","severity":1,"message":"55","line":58,"column":7,"nodeType":"53","messageId":"54","endLine":58,"endColumn":27},{"ruleId":"51","severity":1,"message":"56","line":1,"column":17,"nodeType":"53","messageId":"54","endLine":1,"endColumn":26},{"ruleId":"51","severity":1,"message":"57","line":131,"column":24,"nodeType":"53","messageId":"54","endLine":131,"endColumn":39},{"ruleId":"51","severity":1,"message":"58","line":132,"column":28,"nodeType":"53","messageId":"54","endLine":132,"endColumn":47},{"ruleId":"51","severity":1,"message":"59","line":250,"column":9,"nodeType":"53","messageId":"54","endLine":250,"endColumn":19},{"ruleId":"51","severity":1,"message":"60","line":253,"column":9,"nodeType":"53","messageId":"54","endLine":253,"endColumn":23},{"ruleId":"51","severity":1,"message":"61","line":567,"column":11,"nodeType":"53","messageId":"54","endLine":567,"endColumn":18},{"ruleId":"51","severity":1,"message":"62","line":567,"column":20,"nodeType":"53","messageId":"54","endLine":567,"endColumn":31},{"ruleId":"63","severity":1,"message":"64","line":641,"column":6,"nodeType":"65","endLine":641,"endColumn":8,"suggestions":"66"},{"ruleId":"63","severity":1,"message":"67","line":954,"column":6,"nodeType":"65","endLine":954,"endColumn":19,"suggestions":"68"},{"ruleId":"51","severity":1,"message":"69","line":88,"column":10,"nodeType":"53","messageId":"54","endLine":88,"endColumn":21},"no-native-reassign",["70"],"no-negated-in-lhs",["71"],"no-unused-vars","'renderFamilyTree' is assigned a value but never used.","Identifier","unusedVar","'formatFamilyTreeData' is assigned a value but never used.","'useEffect' is defined but never used.","'setAncestorName' is assigned a value but never used.","'setAncestorLastName' is assigned a value but never used.","'ancestorID' is assigned a value but never used.","'ancestorGender' is assigned a value but never used.","'ancName' is assigned a value but never used.","'ancLastName' is assigned a value but never used.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'topFamilies' and 'weddingYears'. Either include them or remove the dependency array.","ArrayExpression",["72"],"React Hook useEffect has a missing dependency: 'topFamiliesData'. Either include it or remove the dependency array.",["73"],"'treeVisible' is assigned a value but never used.","no-global-assign","no-unsafe-negation",{"desc":"74","fix":"75"},{"desc":"76","fix":"77"},"Update the dependencies array to be: [topFamilies, weddingYears]",{"range":"78","text":"79"},"Update the dependencies array to be: [topFamilies, topFamiliesData]",{"range":"80","text":"81"},[20540,20542],"[topFamilies, weddingYears]",[29358,29371],"[topFamilies, topFamiliesData]"]