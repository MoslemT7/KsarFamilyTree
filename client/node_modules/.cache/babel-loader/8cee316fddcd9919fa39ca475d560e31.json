{"ast":null,"code":"var _jsxFileName = \"D:\\\\Study\\\\Projects\\\\Copy 4\\\\client\\\\src\\\\components\\\\FamilyTree.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport Tree from 'react-d3-tree';\nimport './FamilyTree.css';\nimport neo4j from 'neo4j-driver';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nrequire('dotenv').config();\nconst translations = require('./translation.json');\nconst compundNames = require('./compundNames.json');\nconst neo4jURI = process.env.REACT_APP_NEO4J_URI;\nconst neo4jUser = process.env.REACT_APP_NEO4J_USER;\nconst neo4jPassword = process.env.REACT_APP_NEO4J_PASSWORD;\nconst driver = neo4j.driver(neo4jURI, neo4j.auth.basic(neo4jUser, neo4jPassword));\nlet uniqueKeyCounter = 0;\nexport const translateName = name => {\n  return translations[name] || compundNames[name] || name;\n};\nconst renderFamilyTree = (person, parentId = null, level = 0) => {\n  const uniqueKey = `${person.name}-${person.lastName}-${parentId}-${level}-${uniqueKeyCounter++}`;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"strong\", {\n        children: [person.name, \" \", person.lastName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 29,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 7\n    }, this), person.children && person.children.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginLeft: '20px'\n      },\n      children: person.children.map(child => renderFamilyTree(child, person.id, level + 1))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 9\n    }, this)]\n  }, uniqueKey, true, {\n    fileName: _jsxFileName,\n    lineNumber: 27,\n    columnNumber: 5\n  }, this);\n};\nconst fetchFamilyTree = async () => {\n  const session = driver.session();\n  try {\n    const query = `\n      MATCH (root:Person)\n      WHERE id(root) = 17\n      CALL {\n        WITH root\n        MATCH (root)-[:FATHER_OF*]->(descendant)\n        RETURN collect(DISTINCT descendant) AS allDescendants\n      }\n      WITH root, allDescendants\n      UNWIND [root] + allDescendants AS person\n      OPTIONAL MATCH (person)-[:FATHER_OF]->(child)\n      WITH person, collect(child) AS children\n      RETURN {\n        id: id(person),\n        name: person.name,\n        lastName: person.lastName,\n        children: [child IN children | {\n          id: id(child),\n          name: child.name,\n          lastName: child.lastName\n        }]\n      } AS treeNode\n    `;\n    const result = await session.run(query);\n    const familyTree = result.records.map(record => {\n      const node = record.get('treeNode');\n      return {\n        id: Number(node.id),\n        name: node.name,\n        lastName: node.lastName,\n        children: node.children.map(child => ({\n          id: Number(child.id),\n          name: child.name,\n          lastName: child.lastName\n        }))\n      };\n    });\n    return familyTree; // Return the formatted tree data as JSON\n  } catch (error) {\n    console.error('Error fetching family tree:', error);\n    return []; // Return an empty array in case of error\n  } finally {\n    session.close();\n  }\n};\nconst formatFamilyTreeData = person => {\n  const children = person.children && person.children.length > 0 ? person.children.map(formatFamilyTreeData) // Recursively format children\n  : [];\n  return {\n    name: `${person.name} ${person.lastName}`,\n    children: children // Include children for each person\n  };\n};\nconst getChildrenOfFather = (fatherId, allPeople) => {\n  const father = allPeople.filter(father => father.id === fatherId)[0];\n  return father && father.children ? father.children : [];\n};\nconst buildTree = (person, allPeople) => {\n  if (!person) return null;\n  const children = getChildrenOfFather(person.id, allPeople).map(child => buildTree(child, allPeople)).filter(Boolean);\n  return {\n    id: person.id,\n    name: translateName(person.name),\n    children: children.length > 0 ? children : undefined\n  };\n};\nconst getGenderbyID = async personID => {\n  const session = driver.session();\n  try {\n    // Fix the parameter name to match the query variable\n    const result = await session.run(`MATCH (p:Person) WHERE id(p) = $personId \n      RETURN p.gender AS gender`, {\n      personId: personID\n    } // Ensure the key matches the query's parameter\n    );\n    if (result.records.length > 0) {\n      const gender = result.records[0].get('gender');\n      return gender; // Return the gender value\n    } else {\n      console.log(`No person found with the ID ${personID}`);\n      return null; // Return null when no person is found\n    }\n  } catch (error) {\n    console.error('Error retrieving gender:', error);\n    return null; // Return null in case of an error\n  } finally {\n    await session.close(); // Always close the session after the query\n  }\n};\nconst FamilyTree = ({\n  searchQuery\n}) => {\n  _s();\n  const treeContainerRef = useRef(null);\n  const [familyTree, setFamilyTree] = useState(null);\n  const [husbandId, setHusbandId] = useState(null);\n  const [translate, setTranslate] = useState({\n    x: 500,\n    y: 30\n  });\n  const [zoomLevel, setZoomLevel] = useState(0.2);\n  const [showTree, setShowTree] = useState(false);\n  const nodePositions = useRef({});\n  const handleWomanClick = async person => {\n    const session = driver.session();\n    const gender = await getGenderbyID(person.id);\n    if (gender !== \"Female\") return;\n    try {\n      const result = await session.run(`\n        MATCH (w:Person)-[:WIFE_OF]-(h:Person)\n        WHERE id(w) = $womanId\n        RETURN id(h) as HusbandID\n        LIMIT 1\n      `, {\n        womanId: person.id\n      });\n      if (result.records.length > 0) {\n        const husband = result.records[0].get(\"HusbandID\").toNumber();\n        const coords = nodePositions.current[husband];\n        const container = treeContainerRef.current;\n        if (coords && container) {\n          const bounds = container.getBoundingClientRect();\n          setTranslate({\n            x: bounds.width / 2 - coords.x,\n            y: bounds.height / 2 - coords.y\n          });\n        }\n        setHusbandId(husband);\n      } else {\n        console.log(\"No husband found for\", person.name);\n      }\n    } catch (error) {\n      console.error(\"Error fetching husband:\", error);\n    } finally {\n      await session.close();\n    }\n  };\n  const handlePersonTreeDisplay = async () => {\n    const inputID = document.getElementById('rootID').value;\n    const ID = parseInt(inputID, 10);\n    if (isNaN(ID)) {\n      alert(\"❗ الرجاء إدخال رقم صحيح للشخص.\");\n      return;\n    }\n    loadFamilyTree(ID);\n  };\n  const handleRootTreeClick = async () => {\n    loadFamilyTree(17);\n  };\n  const loadFamilyTree = async rootID => {\n    try {\n      const people = await fetchFamilyTree();\n      if (Array.isArray(people) && people.length > 0) {\n        const rootPerson = people.find(p => p.id === rootID);\n        const treeData = buildTree(rootPerson, people);\n        console.log(treeData);\n        setFamilyTree(treeData);\n        setShowTree(true);\n      } else {\n        console.warn(\"Empty or invalid people data\");\n      }\n    } catch (error) {\n      console.error(\"Error loading family tree:\", error);\n    }\n  };\n  useEffect(() => {\n    const treeContainer = treeContainerRef.current;\n    if (treeContainer) {\n      treeContainer.style.transform = `scale(${zoomLevel})`; // Apply the zoom effect on the tree\n      treeContainer.style.transformOrigin = '0 0'; // Keep the top-left corner fixed\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"treePage\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\u0634\\u062C\\u0631\\u0629 \\u0639\\u0627\\u0626\\u0644\\u0629 \\u0642\\u0635\\u0631 \\u0623\\u0648\\u0644\\u0627\\u062F \\u0628\\u0648\\u0628\\u0643\\u0631\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"description\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u0641\\u064A \\u0647\\u0630\\u0647 \\u0627\\u0644\\u0635\\u0641\\u062D\\u0629 \\u064A\\u0645\\u0643\\u0646\\u0643 \\u062A\\u0635\\u0641\\u062D \\u0634\\u062C\\u0631\\u0629 \\u0639\\u0631\\u0634 \\u0642\\u0635\\u0631 \\u0623\\u0648\\u0644\\u0627\\u062F \\u0628\\u0648\\u0628\\u0643\\u0631 \\u0643\\u0627\\u0645\\u0644\\u0629 \\u060C \\u0645\\u0646\\u0630 \\u0627\\u0644\\u062C\\u062F \\u0627\\u0644\\u0623\\u0648\\u0644 \\u0628\\u0648\\u0628\\u0643\\u0631 \\u0627\\u0644\\u0649 \\u062D\\u064A\\u0646 \\u0627\\u0644\\u062C\\u064A\\u0644 \\u0627\\u0644\\u062D\\u0627\\u0644\\u064A.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"filterChoice\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card filter-left\",\n          children: /*#__PURE__*/_jsxDEV(\"form\", {\n            className: \"filterChoiceForm\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u0632\\u0631 \\\"\\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0645\\u0646\\u0630 \\u0627\\u0644\\u062C\\u062F \\u0627\\u0644\\u0623\\u0648\\u0644\\\" \\u064A\\u062A\\u064A\\u062D \\u0644\\u0643 \\u0639\\u0631\\u0636 \\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0628\\u062F\\u0621\\u064B\\u0627 \\u0645\\u0646 \\u0627\\u0644\\u062C\\u062F \\u0627\\u0644\\u0623\\u0648\\u0644 \\u0644\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629\\u060C \\u0648\\u0647\\u0648 \\u0627\\u0644\\u062C\\u0630\\u0631 \\u0627\\u0644\\u0630\\u064A \\u062A\\u062A\\u0641\\u0631\\u0639 \\u0645\\u0646\\u0647 \\u062C\\u0645\\u064A\\u0639 \\u0627\\u0644\\u0623\\u062C\\u064A\\u0627\\u0644 \\u0627\\u0644\\u062A\\u0627\\u0644\\u064A\\u0629. \\u0639\\u0646\\u062F \\u0627\\u0644\\u0636\\u063A\\u0637 \\u0639\\u0644\\u0649 \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0632\\u0631\\u060C \\u0633\\u064A\\u062A\\u0645 \\u062A\\u062D\\u0645\\u064A\\u0644 \\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0628\\u0627\\u0644\\u0643\\u0627\\u0645\\u0644 \\u0628\\u062F\\u0621\\u064B\\u0627 \\u0645\\u0646 \\u0630\\u0644\\u0643 \\u0627\\u0644\\u0634\\u062E\\u0635\\u060C \\u0645\\u0645\\u0627 \\u064A\\u062A\\u064A\\u062D \\u0644\\u0643 \\u0627\\u0633\\u062A\\u0643\\u0634\\u0627\\u0641 \\u0627\\u0644\\u0631\\u0648\\u0627\\u0628\\u0637 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u064A\\u0629 \\u0628\\u064A\\u0646 \\u0627\\u0644\\u0623\\u0641\\u0631\\u0627\\u062F \\u0639\\u0628\\u0631 \\u0627\\u0644\\u0623\\u062C\\u064A\\u0627\\u0644 \\u0627\\u0644\\u0645\\u062E\\u062A\\u0644\\u0641\\u0629\\u060C \\u0648\\u062A\\u0639\\u0631\\u0641 \\u0623\\u0643\\u062B\\u0631 \\u0639\\u0644\\u0649 \\u062A\\u0627\\u0631\\u064A\\u062E \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0648\\u0639\\u0644\\u0627\\u0642\\u0627\\u062A\\u0647\\u0627.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"btn-root\",\n              onClick: handleRootTreeClick,\n              children: \"\\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0645\\u0646\\u0630 \\u0627\\u0644\\u062C\\u062F \\u0627\\u0644\\u0623\\u0648\\u0644\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 243,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card filter-right\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"\\u0644\\u0644\\u062D\\u0635\\u0648\\u0644 \\u0639\\u0644\\u0649 \\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0648\\u064A\\u0629 (\\u0631\\u0642\\u0645 \\u0627\\u0644\\u062A\\u0633\\u0644\\u0633\\u0644) \\u0644\\u0644\\u0634\\u062E\\u0635\\u060C \\u064A\\u062C\\u0628 \\u0639\\u0644\\u064A\\u0643 \\u0627\\u0644\\u062A\\u0648\\u062C\\u0647 \\u0625\\u0644\\u0649 \\u0635\\u0641\\u062D\\u0629 \\u0627\\u0644\\u0628\\u062D\\u062B \\u062B\\u0645 \\u0627\\u0644\\u0628\\u062D\\u062B \\u0639\\u0646 \\u0627\\u0644\\u0634\\u062E\\u0635 \\u0627\\u0644\\u0645\\u0637\\u0644\\u0648\\u0628. \\u0628\\u0639\\u062F \\u0625\\u062C\\u0631\\u0627\\u0621 \\u0627\\u0644\\u0628\\u062D\\u062B\\u060C \\u0633\\u064A\\u0638\\u0647\\u0631 \\u0631\\u0642\\u0645 \\u0627\\u0644\\u062A\\u0633\\u0644\\u0633\\u0644 (\\u0631\\u0642\\u0645 \\u0627\\u0644\\u0647\\u0648\\u064A\\u0629) \\u0645\\u0628\\u0627\\u0634\\u0631\\u0629\\u064B \\u0641\\u0648\\u0642 \\u0627\\u0644\\u0627\\u0633\\u0645 \\u0627\\u0644\\u0643\\u0627\\u0645\\u0644 \\u0644\\u0644\\u0634\\u062E\\u0635 \\u0641\\u064A \\u0642\\u0633\\u0645 \\u0627\\u0644\\u0646\\u062A\\u0627\\u0626\\u062C. \\u064A\\u0645\\u0643\\u0646\\u0643 \\u0646\\u0633\\u062E \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0631\\u0642\\u0645 \\u0648\\u0645\\u0646 \\u062B\\u0645 \\u0644\\u0635\\u0642\\u0647 \\u0647\\u0646\\u0627 \\u0644\\u0631\\u0624\\u064A\\u0629 \\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0628\\u062F\\u0621\\u064B\\u0627 \\u0645\\u0646 \\u0630\\u0644\\u0643 \\u0627\\u0644\\u0634\\u062E\\u0635.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"rootID\",\n            type: \"number\",\n            placeholder: \"\\u0623\\u062F\\u062E\\u0644 \\u0631\\u0642\\u0645 \\u0627\\u0644\\u0634\\u062E\\u0635\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn-person\",\n            type: \"button\",\n            onClick: handlePersonTreeDisplay,\n            children: \"\\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0627\\u0628\\u062A\\u062F\\u0627\\u0621\\u0627 \\u0645\\u0646 \\u0634\\u062E\\u0635 \\u0645\\u0639\\u064A\\u0646:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card personSearch\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"\\u0632\\u0631 \\\"\\u0627\\u0628\\u062D\\u062B \\u0639\\u0646 \\u0634\\u062E\\u0635 \\u0641\\u064A \\u0627\\u0644\\u0634\\u062C\\u0631\\u0629\\\" \\u064A\\u062A\\u064A\\u062D \\u0644\\u0643 \\u0627\\u0644\\u0628\\u062D\\u062B \\u0639\\u0646 \\u0641\\u0631\\u062F \\u0645\\u0639\\u064A\\u0646 \\u062F\\u0627\\u062E\\u0644 \\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629. \\u0639\\u0646\\u062F \\u0643\\u062A\\u0627\\u0628\\u0629 \\u0627\\u0633\\u0645 \\u0627\\u0644\\u0634\\u062E\\u0635 \\u0641\\u064A \\u062E\\u0627\\u0646\\u0629 \\u0627\\u0644\\u0628\\u062D\\u062B\\u060C \\u0633\\u062A\\u062A\\u0645\\u0643\\u0646 \\u0645\\u0646 \\u0627\\u0644\\u0639\\u062B\\u0648\\u0631 \\u0639\\u0644\\u0649 \\u0645\\u0639\\u0644\\u0648\\u0645\\u0627\\u062A\\u0647 \\u0636\\u0645\\u0646 \\u0627\\u0644\\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u064A\\u0629 \\u0648\\u0631\\u0624\\u064A\\u0629 \\u0645\\u0643\\u0627\\u0646\\u0647 \\u0636\\u0645\\u0646 \\u0627\\u0644\\u0623\\u062C\\u064A\\u0627\\u0644 \\u0627\\u0644\\u0645\\u062E\\u062A\\u0644\\u0641\\u0629. \\u064A\\u0633\\u0627\\u0639\\u062F\\u0643 \\u0647\\u0630\\u0627 \\u0627\\u0644\\u0632\\u0631 \\u0641\\u064A \\u062A\\u062D\\u062F\\u064A\\u062F \\u0645\\u0648\\u0642\\u0639 \\u0623\\u064A \\u0641\\u0631\\u062F \\u0641\\u064A \\u0634\\u062C\\u0631\\u0629 \\u0627\\u0644\\u0639\\u0627\\u0626\\u0644\\u0629 \\u0628\\u0634\\u0643\\u0644 \\u0633\\u0631\\u064A\\u0639 \\u0648\\u0641\\u0639\\u0627\\u0644.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"personsearchName\",\n            type: \"text\",\n            placeholder: \"\\u0627\\u0628\\u062D\\u062B \\u0639\\u0646 \\u0634\\u062E\\u0635 \\u0641\\u064A \\u0627\\u0644\\u0634\\u062C\\u0631\\u0629\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this), showTree && familyTree && /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"treeWrapper\",\n      ref: treeContainerRef,\n      style: {\n        width: \"100vw\",\n        height: \"100vh\",\n        overflow: 'hidden',\n        transformOrigin: '0 0',\n        position: 'relative'\n      },\n      children: /*#__PURE__*/_jsxDEV(Tree, {\n        data: familyTree,\n        orientation: \"vertical\",\n        pathFunc: \"step\",\n        translate: translate,\n        nodeSize: {\n          x: 100,\n          y: 100\n        } // Adjust node size if needed\n        ,\n        separation: {\n          siblings: 1.1,\n          nonSiblings: 1.5\n        } // Adjust separation between nodes\n        ,\n        renderCustomNodeElement: ({\n          nodeDatum,\n          hierarchyPointNode\n        }) => {\n          const isHusband = nodeDatum.id === husbandId;\n\n          // Record node position\n          nodePositions.current[nodeDatum.id] = {\n            x: hierarchyPointNode.x,\n            y: hierarchyPointNode.y\n          };\n          return /*#__PURE__*/_jsxDEV(\"g\", {\n            onClick: () => handleWomanClick(nodeDatum),\n            style: {\n              cursor: \"pointer\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"title\", {\n              children: nodeDatum.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"rect\", {\n              x: \"-50\",\n              y: \"-20\",\n              width: \"100\",\n              height: \"40\",\n              fill: isHusband ? \"#66bb6a\" : \"#4fc3f7\",\n              stroke: \"black\",\n              strokeWidth: \"2\",\n              rx: \"8\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 309,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"text\", {\n              x: \"0\",\n              y: \"5\",\n              style: {\n                fontSize: \"22\",\n                fontFamily: 'Cairo',\n                dominantBaseline: 'middle',\n                letterSpacing: '1px',\n                strokeWidth: '0px',\n                textAnchor: \"middle\",\n                fill: \"white\"\n              },\n              children: nodeDatum.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 13\n          }, this);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 35\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"footerTips\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 234,\n    columnNumber: 5\n  }, this);\n};\n_s(FamilyTree, \"/PtSaBfVDfJwbAd72a9q5phXNo8=\");\n_c = FamilyTree;\nexport default FamilyTree;\nvar _c;\n$RefreshReg$(_c, \"FamilyTree\");","map":{"version":3,"names":["React","useEffect","useState","useRef","Tree","neo4j","jsxDEV","_jsxDEV","require","config","translations","compundNames","neo4jURI","process","env","REACT_APP_NEO4J_URI","neo4jUser","REACT_APP_NEO4J_USER","neo4jPassword","REACT_APP_NEO4J_PASSWORD","driver","auth","basic","uniqueKeyCounter","translateName","name","renderFamilyTree","person","parentId","level","uniqueKey","lastName","children","fileName","_jsxFileName","lineNumber","columnNumber","length","style","marginLeft","map","child","id","fetchFamilyTree","session","query","result","run","familyTree","records","record","node","get","Number","error","console","close","formatFamilyTreeData","getChildrenOfFather","fatherId","allPeople","father","filter","buildTree","Boolean","undefined","getGenderbyID","personID","personId","gender","log","FamilyTree","searchQuery","_s","treeContainerRef","setFamilyTree","husbandId","setHusbandId","translate","setTranslate","x","y","zoomLevel","setZoomLevel","showTree","setShowTree","nodePositions","handleWomanClick","womanId","husband","toNumber","coords","current","container","bounds","getBoundingClientRect","width","height","handlePersonTreeDisplay","inputID","document","getElementById","value","ID","parseInt","isNaN","alert","loadFamilyTree","handleRootTreeClick","rootID","people","Array","isArray","rootPerson","find","p","treeData","warn","treeContainer","transform","transformOrigin","className","type","onClick","placeholder","ref","overflow","position","data","orientation","pathFunc","nodeSize","separation","siblings","nonSiblings","renderCustomNodeElement","nodeDatum","hierarchyPointNode","isHusband","cursor","fill","stroke","strokeWidth","rx","fontSize","fontFamily","dominantBaseline","letterSpacing","textAnchor","_c","$RefreshReg$"],"sources":["D:/Study/Projects/Copy 4/client/src/components/FamilyTree.js"],"sourcesContent":["import React, { useEffect, useState , useRef } from 'react';\r\nimport Tree from 'react-d3-tree';\r\nimport './FamilyTree.css';\r\nimport neo4j from 'neo4j-driver';\r\n\r\nrequire('dotenv').config();\r\n\r\nconst translations = require('./translation.json');\r\nconst compundNames = require('./compundNames.json');\r\nconst neo4jURI = process.env.REACT_APP_NEO4J_URI;\r\nconst neo4jUser = process.env.REACT_APP_NEO4J_USER; \r\nconst neo4jPassword = process.env.REACT_APP_NEO4J_PASSWORD;\r\nconst driver = neo4j.driver(\r\n  neo4jURI, \r\n  neo4j.auth.basic(neo4jUser, neo4jPassword)\r\n);\r\n\r\nlet uniqueKeyCounter = 0;\r\nexport const translateName = (name) => {\r\n  return translations[name] || compundNames[name] || name;\r\n};\r\n\r\nconst renderFamilyTree = (person, parentId = null, level = 0) => {\r\n  const uniqueKey = `${person.name}-${person.lastName}-${parentId}-${level}-${uniqueKeyCounter++}`;\r\n\r\n  return (\r\n    <div key={uniqueKey}>\r\n      <div>\r\n        <strong>{person.name} {person.lastName}</strong>\r\n      </div>\r\n      {person.children && person.children.length > 0 && (\r\n        <div style={{ marginLeft: '20px' }}>\r\n          {person.children.map((child) => renderFamilyTree(child, person.id, level + 1))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst fetchFamilyTree = async () => {\r\n  const session = driver.session();\r\n  try {\r\n    const query = `\r\n      MATCH (root:Person)\r\n      WHERE id(root) = 17\r\n      CALL {\r\n        WITH root\r\n        MATCH (root)-[:FATHER_OF*]->(descendant)\r\n        RETURN collect(DISTINCT descendant) AS allDescendants\r\n      }\r\n      WITH root, allDescendants\r\n      UNWIND [root] + allDescendants AS person\r\n      OPTIONAL MATCH (person)-[:FATHER_OF]->(child)\r\n      WITH person, collect(child) AS children\r\n      RETURN {\r\n        id: id(person),\r\n        name: person.name,\r\n        lastName: person.lastName,\r\n        children: [child IN children | {\r\n          id: id(child),\r\n          name: child.name,\r\n          lastName: child.lastName\r\n        }]\r\n      } AS treeNode\r\n    `;\r\n\r\n    const result = await session.run(query);\r\n\r\n    const familyTree = result.records.map(record => {\r\n      const node = record.get('treeNode');\r\n      return {\r\n        id: Number(node.id),\r\n        name: node.name,\r\n        lastName: node.lastName,\r\n        children: node.children.map(child => ({\r\n          id: Number(child.id),\r\n          name: child.name,\r\n          lastName: child.lastName\r\n        }))\r\n      };\r\n    });\r\n\r\n    return familyTree; // Return the formatted tree data as JSON\r\n  } catch (error) {\r\n    console.error('Error fetching family tree:', error);\r\n    return []; // Return an empty array in case of error\r\n  } finally {\r\n    session.close();\r\n  }\r\n};\r\n\r\nconst formatFamilyTreeData = (person) => {\r\n  const children = person.children && person.children.length > 0\r\n    ? person.children.map(formatFamilyTreeData) // Recursively format children\r\n    : [];\r\n\r\n  return {\r\n    name: `${person.name} ${person.lastName}`,\r\n    children: children // Include children for each person\r\n  };\r\n};\r\n\r\nconst getChildrenOfFather = (fatherId, allPeople) => {\r\n  const father = allPeople.filter(father => father.id === fatherId)[0];  \r\n  return father && father.children ? father.children : [];  \r\n};\r\n\r\nconst buildTree = (person, allPeople) => {\r\n  if (!person) return null;\r\n\r\n  const children = getChildrenOfFather(person.id, allPeople)\r\n    .map(child => buildTree(child, allPeople))\r\n    .filter(Boolean); \r\n\r\n    \r\n    return {\r\n      id: person.id,\r\n      name: translateName(person.name),\r\n      children: children.length > 0 ? children : undefined,\r\n    };\r\n};\r\n\r\nconst getGenderbyID = async (personID) => {\r\n  const session = driver.session();\r\n  try {\r\n    // Fix the parameter name to match the query variable\r\n    const result = await session.run(\r\n      `MATCH (p:Person) WHERE id(p) = $personId \r\n      RETURN p.gender AS gender`,\r\n      { personId: personID } // Ensure the key matches the query's parameter\r\n    );\r\n    \r\n    if (result.records.length > 0) {\r\n      const gender = result.records[0].get('gender');\r\n      return gender; // Return the gender value\r\n    } else {\r\n      console.log(`No person found with the ID ${personID}`);\r\n      return null; // Return null when no person is found\r\n    }\r\n  } catch (error) {\r\n    console.error('Error retrieving gender:', error);\r\n    return null; // Return null in case of an error\r\n  } finally {\r\n    await session.close(); // Always close the session after the query\r\n  }\r\n};\r\n\r\nconst FamilyTree = ({ searchQuery }) => {\r\n  const treeContainerRef = useRef(null);\r\n  const [familyTree, setFamilyTree] = useState(null);\r\n  const [husbandId, setHusbandId] = useState(null);\r\n  const [translate, setTranslate] = useState({ x: 500, y: 30 });\r\n  const [zoomLevel, setZoomLevel] = useState(0.2);\r\n  const [showTree, setShowTree] = useState(false);\r\n  const nodePositions = useRef({});\r\n\r\n  const handleWomanClick = async (person) => {\r\n    const session = driver.session();\r\n    const gender = await getGenderbyID(person.id);\r\n    if (gender !== \"Female\") return;\r\n\r\n    try {\r\n      const result = await session.run(\r\n        `\r\n        MATCH (w:Person)-[:WIFE_OF]-(h:Person)\r\n        WHERE id(w) = $womanId\r\n        RETURN id(h) as HusbandID\r\n        LIMIT 1\r\n      `,\r\n        { womanId: person.id }\r\n      );\r\n\r\n      if (result.records.length > 0) {\r\n        const husband = result.records[0].get(\"HusbandID\").toNumber();\r\n        const coords = nodePositions.current[husband];\r\n        const container = treeContainerRef.current;\r\n\r\n        if (coords && container) {\r\n          const bounds = container.getBoundingClientRect();\r\n          setTranslate({\r\n            x: bounds.width / 2 - coords.x,\r\n            y: bounds.height / 2 - coords.y,\r\n          });\r\n        }\r\n\r\n        setHusbandId(husband);\r\n      } else {\r\n        console.log(\"No husband found for\", person.name);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching husband:\", error);\r\n    } finally {\r\n      await session.close();\r\n    }\r\n  };\r\n  const handlePersonTreeDisplay = async () => {\r\n    const inputID = document.getElementById('rootID').value;\r\n    const ID = parseInt(inputID, 10);\r\n\r\n    if (isNaN(ID)) {\r\n      alert(\"❗ الرجاء إدخال رقم صحيح للشخص.\");\r\n      return;\r\n    }\r\n    loadFamilyTree(ID);\r\n  }\r\n  const handleRootTreeClick = async () => {\r\n    loadFamilyTree(17);\r\n  };\r\n  const loadFamilyTree = async (rootID) => {\r\n    try {\r\n      const people = await fetchFamilyTree();\r\n      if (Array.isArray(people) && people.length > 0) {\r\n        const rootPerson = people.find((p) => p.id === rootID);\r\n        const treeData = buildTree(rootPerson, people);\r\n        console.log(treeData);\r\n        setFamilyTree(treeData);\r\n        setShowTree(true);\r\n      } else {\r\n        console.warn(\"Empty or invalid people data\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error loading family tree:\", error);\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    const treeContainer = treeContainerRef.current;\r\n    if (treeContainer) {\r\n      treeContainer.style.transform = `scale(${zoomLevel})`; // Apply the zoom effect on the tree\r\n      treeContainer.style.transformOrigin = '0 0'; // Keep the top-left corner fixed\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"treePage\">\r\n      <header>\r\n        <h2>شجرة عائلة قصر أولاد بوبكر</h2>\r\n        <div className=\"description\">\r\n          <p>\r\n            في هذه الصفحة يمكنك تصفح شجرة عرش قصر أولاد بوبكر كاملة ، منذ الجد الأول بوبكر الى حين الجيل الحالي.\r\n          </p>\r\n        </div>\r\n        <div className=\"filterChoice\">\r\n          <div className=\"card filter-left\">\r\n            <form className=\"filterChoiceForm\">\r\n              <p>زر \"شجرة العائلة منذ الجد الأول\" يتيح لك عرض شجرة العائلة بدءًا من الجد الأول للعائلة،\r\n                 وهو الجذر الذي تتفرع منه جميع الأجيال التالية.\r\n                 عند الضغط على هذا الزر، سيتم تحميل شجرة العائلة بالكامل بدءًا من ذلك الشخص،\r\n                 مما يتيح لك استكشاف الروابط العائلية بين الأفراد عبر الأجيال المختلفة،\r\n                 وتعرف أكثر على تاريخ العائلة وعلاقاتها.</p>\r\n              <button type=\"button\" className=\"btn-root\" onClick={handleRootTreeClick}>\r\n                شجرة العائلة منذ الجد الأول\r\n              </button>\r\n            </form>\r\n          </div>\r\n          \r\n          <div className=\"card filter-right\">\r\n            <p>\r\n              للحصول على رقم الهوية (رقم التسلسل) للشخص، يجب عليك التوجه إلى صفحة البحث ثم البحث عن الشخص المطلوب.\r\n              بعد إجراء البحث، سيظهر رقم التسلسل (رقم الهوية) مباشرةً فوق الاسم الكامل للشخص في قسم النتائج. يمكنك نسخ\r\n              هذا الرقم ومن ثم لصقه هنا لرؤية شجرة العائلة بدءًا من ذلك الشخص.\r\n            </p>\r\n            <input id=\"rootID\" type=\"number\" placeholder=\"أدخل رقم الشخص\" />\r\n            <button className=\"btn-person\" type=\"button\" onClick={handlePersonTreeDisplay}>\r\n              شجرة العائلة ابتداءا من شخص معين:\r\n            </button>\r\n          </div>\r\n          \r\n          <div className=\"card personSearch\">\r\n            <p>زر \"ابحث عن شخص في الشجرة\" يتيح لك البحث عن فرد معين داخل شجرة العائلة.\r\n               عند كتابة اسم الشخص في خانة البحث،\r\n               ستتمكن من العثور على معلوماته ضمن الشجرة العائلية ورؤية مكانه ضمن الأجيال المختلفة.\r\n               يساعدك هذا الزر في تحديد موقع أي فرد في شجرة العائلة بشكل سريع وفعال.\r\n            </p>\r\n            <input id=\"personsearchName\" type=\"text\" placeholder=\"ابحث عن شخص في الشجرة\" />\r\n          </div>\r\n        </div>\r\n\r\n\r\n        \r\n      </header>\r\n\r\n      {showTree && familyTree && (<div\r\n      id=\"treeWrapper\"\r\n      ref={treeContainerRef}\r\n      style={{ width: \"100vw\", height: \"100vh\" , overflow: 'hidden', transformOrigin: '0 0', position:'relative'}}\r\n    >\r\n      <Tree\r\n        data={familyTree}\r\n        orientation=\"vertical\"\r\n        pathFunc=\"step\"\r\n        translate={translate}\r\n        nodeSize={{ x: 100, y: 100 }} // Adjust node size if needed\r\n        separation={{ siblings: 1.1, nonSiblings: 1.5 }} // Adjust separation between nodes\r\n        renderCustomNodeElement={({ nodeDatum, hierarchyPointNode }) => {\r\n          const isHusband = nodeDatum.id === husbandId;\r\n\r\n          // Record node position\r\n          nodePositions.current[nodeDatum.id] = {\r\n            x: hierarchyPointNode.x,\r\n            y: hierarchyPointNode.y,\r\n          };\r\n\r\n          return (\r\n            <g\r\n              onClick={() => handleWomanClick(nodeDatum)}\r\n              style={{ cursor: \"pointer\" }}\r\n            >\r\n              <title>{nodeDatum.id}</title>\r\n              <rect\r\n                x=\"-50\"\r\n                y=\"-20\"\r\n                width=\"100\"\r\n                height=\"40\"\r\n                \r\n                fill={isHusband ? \"#66bb6a\" : \"#4fc3f7\"}\r\n                stroke=\"black\"\r\n                strokeWidth=\"2\"\r\n                rx=\"8\"\r\n              />\r\n              <text\r\n                x=\"0\"\r\n                y=\"5\"\r\n                style={{\r\n                  \r\n                  fontSize:\"22\",\r\n                  fontFamily:'Cairo',\r\n                  dominantBaseline: 'middle',\r\n                  letterSpacing: '1px',\r\n                  strokeWidth: '0px',\r\n                  textAnchor:\"middle\",\r\n                  fill:\"white\"\r\n                }}\r\n                \r\n              >\r\n                {nodeDatum.name}\r\n              </text>\r\n            </g>\r\n          );\r\n        }}\r\n      />\r\n      </div>\r\n    )}\r\n      <div className='footerTips'>\r\n\r\n      </div>\r\n    </div>\r\n    \r\n  );\r\n};\r\n\r\nexport default FamilyTree;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}