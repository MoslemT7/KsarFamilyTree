{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TransactionExecutor = void 0;\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/promise-function-async */\nvar error_1 = require(\"../error\");\nvar constants_1 = require(\"./constants\");\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\nfunction setTimeoutWrapper(callback, ms) {\n  var args = [];\n  for (var _i = 2; _i < arguments.length; _i++) {\n    args[_i - 2] = arguments[_i];\n  }\n  return setTimeout.apply(void 0, __spreadArray([callback, ms], __read(args), false));\n}\nfunction clearTimeoutWrapper(timeoutId) {\n  return clearTimeout(timeoutId);\n}\nvar TransactionExecutor = /** @class */function () {\n  function TransactionExecutor(maxRetryTimeMs, initialRetryDelayMs, multiplier, jitterFactor, dependencies) {\n    if (dependencies === void 0) {\n      dependencies = {\n        setTimeout: setTimeoutWrapper,\n        clearTimeout: clearTimeoutWrapper\n      };\n    }\n    this._maxRetryTimeMs = _valueOrDefault(maxRetryTimeMs, DEFAULT_MAX_RETRY_TIME_MS);\n    this._initialRetryDelayMs = _valueOrDefault(initialRetryDelayMs, DEFAULT_INITIAL_RETRY_DELAY_MS);\n    this._multiplier = _valueOrDefault(multiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n    this._jitterFactor = _valueOrDefault(jitterFactor, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n    this._setTimeout = dependencies.setTimeout;\n    this._clearTimeout = dependencies.clearTimeout;\n    this._inFlightTimeoutIds = [];\n    this.pipelineBegin = false;\n    this.telemetryApi = constants_1.TELEMETRY_APIS.MANAGED_TRANSACTION;\n    this._verifyAfterConstruction();\n  }\n  TransactionExecutor.prototype.execute = function (transactionCreator, transactionWork, transactionWrapper) {\n    var _this = this;\n    var context = {\n      apiTransactionConfig: {\n        api: this.telemetryApi,\n        onTelemetrySuccess: function () {\n          context.apiTransactionConfig = undefined;\n        }\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, context).catch(reject);\n    }).catch(function (error) {\n      var retryStartTimeMs = Date.now();\n      var retryDelayMs = _this._initialRetryDelayMs;\n      return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTimeMs, retryDelayMs, transactionWrapper, context);\n    });\n  };\n  TransactionExecutor.prototype.close = function () {\n    var _this = this;\n    // cancel all existing timeouts to prevent further retries\n    this._inFlightTimeoutIds.forEach(function (timeoutId) {\n      return _this._clearTimeout(timeoutId);\n    });\n    this._inFlightTimeoutIds = [];\n  };\n  TransactionExecutor.prototype._retryTransactionPromise = function (transactionCreator, transactionWork, error, retryStartTime, retryDelayMs, transactionWrapper, executionContext) {\n    var _this = this;\n    var elapsedTimeMs = Date.now() - retryStartTime;\n    if (elapsedTimeMs > this._maxRetryTimeMs || !(0, error_1.isRetriableError)(error)) {\n      return Promise.reject(error);\n    }\n    return new Promise(function (resolve, reject) {\n      var nextRetryTime = _this._computeDelayWithJitter(retryDelayMs);\n      var timeoutId = _this._setTimeout(function () {\n        // filter out this timeoutId when time has come and function is being executed\n        _this._inFlightTimeoutIds = _this._inFlightTimeoutIds.filter(function (id) {\n          return id !== timeoutId;\n        });\n        _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext).catch(reject);\n      }, nextRetryTime);\n      // add newly created timeoutId to the list of all in-flight timeouts\n      _this._inFlightTimeoutIds.push(timeoutId);\n    }).catch(function (error) {\n      var nextRetryDelayMs = retryDelayMs * _this._multiplier;\n      return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTime, nextRetryDelayMs, transactionWrapper, executionContext);\n    });\n  };\n  TransactionExecutor.prototype._executeTransactionInsidePromise = function (transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tx, txPromise, _a, error_2, wrap, wrappedTx, resultPromise;\n      var _this = this;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _b.trys.push([0, 4,, 5]);\n            txPromise = transactionCreator((executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) != null ? __assign({}, executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) : undefined);\n            if (!this.pipelineBegin) return [3 /*break*/, 1];\n            _a = txPromise;\n            return [3 /*break*/, 3];\n          case 1:\n            return [4 /*yield*/, txPromise];\n          case 2:\n            _a = _b.sent();\n            _b.label = 3;\n          case 3:\n            tx = _a;\n            return [3 /*break*/, 5];\n          case 4:\n            error_2 = _b.sent();\n            // failed to create a transaction\n            reject(error_2);\n            return [2 /*return*/];\n          case 5:\n            wrap = transactionWrapper !== null && transactionWrapper !== void 0 ? transactionWrapper : function (tx) {\n              return tx;\n            };\n            wrappedTx = wrap(tx);\n            resultPromise = this._safeExecuteTransactionWork(wrappedTx, transactionWork);\n            resultPromise.then(function (result) {\n              return _this._handleTransactionWorkSuccess(result, tx, resolve, reject);\n            }).catch(function (error) {\n              return _this._handleTransactionWorkFailure(error, tx, reject);\n            });\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  TransactionExecutor.prototype._safeExecuteTransactionWork = function (tx, transactionWork) {\n    try {\n      var result = transactionWork(tx);\n      // user defined callback is supposed to return a promise, but it might not; so to protect against an\n      // incorrect API usage we wrap the returned value with a resolved promise; this is effectively a\n      // validation step without type checks\n      return Promise.resolve(result);\n    } catch (error) {\n      return Promise.reject(error);\n    }\n  };\n  TransactionExecutor.prototype._handleTransactionWorkSuccess = function (result, tx, resolve, reject) {\n    if (tx.isOpen()) {\n      // transaction work returned resolved promise and transaction has not been committed/rolled back\n      // try to commit the transaction\n      tx.commit().then(function () {\n        // transaction was committed, return result to the user\n        resolve(result);\n      }).catch(function (error) {\n        // transaction failed to commit, propagate the failure\n        reject(error);\n      });\n    } else {\n      // transaction work returned resolved promise and transaction is already committed/rolled back\n      // return the result returned by given transaction work\n      resolve(result);\n    }\n  };\n  TransactionExecutor.prototype._handleTransactionWorkFailure = function (error, tx, reject) {\n    if (tx.isOpen()) {\n      // transaction work failed and the transaction is still open, roll it back and propagate the failure\n      tx.rollback().catch(function (ignore) {\n        // ignore the rollback error\n      }).then(function () {\n        return reject(error);\n      }) // propagate the original error we got from the transaction work\n      .catch(reject);\n    } else {\n      // transaction is already rolled back, propagate the error\n      reject(error);\n    }\n  };\n  TransactionExecutor.prototype._computeDelayWithJitter = function (delayMs) {\n    var jitter = delayMs * this._jitterFactor;\n    var min = delayMs - jitter;\n    var max = delayMs + jitter;\n    return Math.random() * (max - min) + min;\n  };\n  TransactionExecutor.prototype._verifyAfterConstruction = function () {\n    if (this._maxRetryTimeMs < 0) {\n      throw (0, error_1.newError)('Max retry time should be >= 0: ' + this._maxRetryTimeMs.toString());\n    }\n    if (this._initialRetryDelayMs < 0) {\n      throw (0, error_1.newError)('Initial retry delay should >= 0: ' + this._initialRetryDelayMs.toString());\n    }\n    if (this._multiplier < 1.0) {\n      throw (0, error_1.newError)('Multiplier should be >= 1.0: ' + this._multiplier.toString());\n    }\n    if (this._jitterFactor < 0 || this._jitterFactor > 1) {\n      throw (0, error_1.newError)('Jitter factor should be in [0.0, 1.0]: ' + this._jitterFactor.toFixed());\n    }\n  };\n  return TransactionExecutor;\n}();\nexports.TransactionExecutor = TransactionExecutor;\nfunction _valueOrDefault(value, defaultValue) {\n  if (value != null) {\n    return value;\n  }\n  return defaultValue;\n}","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__read","o","m","r","ar","error","__spreadArray","to","from","pack","l","Array","slice","concat","defineProperty","exports","TransactionExecutor","error_1","require","constants_1","DEFAULT_MAX_RETRY_TIME_MS","DEFAULT_INITIAL_RETRY_DELAY_MS","DEFAULT_RETRY_DELAY_MULTIPLIER","DEFAULT_RETRY_DELAY_JITTER_FACTOR","setTimeoutWrapper","callback","ms","args","_i","setTimeout","clearTimeoutWrapper","timeoutId","clearTimeout","maxRetryTimeMs","initialRetryDelayMs","multiplier","jitterFactor","dependencies","_maxRetryTimeMs","_valueOrDefault","_initialRetryDelayMs","_multiplier","_jitterFactor","_setTimeout","_clearTimeout","_inFlightTimeoutIds","pipelineBegin","telemetryApi","TELEMETRY_APIS","MANAGED_TRANSACTION","_verifyAfterConstruction","execute","transactionCreator","transactionWork","transactionWrapper","_this","context","apiTransactionConfig","api","onTelemetrySuccess","undefined","_executeTransactionInsidePromise","catch","retryStartTimeMs","Date","now","retryDelayMs","_retryTransactionPromise","close","forEach","retryStartTime","executionContext","elapsedTimeMs","isRetriableError","nextRetryTime","_computeDelayWithJitter","filter","id","nextRetryDelayMs","tx","txPromise","_a","error_2","wrap","wrappedTx","resultPromise","_b","_safeExecuteTransactionWork","_handleTransactionWorkSuccess","_handleTransactionWorkFailure","isOpen","commit","rollback","ignore","delayMs","jitter","min","max","Math","random","newError","toString","toFixed","defaultValue"],"sources":["D:/Study/Projects/Copy 4/client/node_modules/neo4j-driver-core/lib/internal/transaction-executor.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TransactionExecutor = void 0;\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* eslint-disable @typescript-eslint/promise-function-async */\nvar error_1 = require(\"../error\");\nvar constants_1 = require(\"./constants\");\nvar DEFAULT_MAX_RETRY_TIME_MS = 30 * 1000; // 30 seconds\nvar DEFAULT_INITIAL_RETRY_DELAY_MS = 1000; // 1 seconds\nvar DEFAULT_RETRY_DELAY_MULTIPLIER = 2.0;\nvar DEFAULT_RETRY_DELAY_JITTER_FACTOR = 0.2;\nfunction setTimeoutWrapper(callback, ms) {\n    var args = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        args[_i - 2] = arguments[_i];\n    }\n    return setTimeout.apply(void 0, __spreadArray([callback, ms], __read(args), false));\n}\nfunction clearTimeoutWrapper(timeoutId) {\n    return clearTimeout(timeoutId);\n}\nvar TransactionExecutor = /** @class */ (function () {\n    function TransactionExecutor(maxRetryTimeMs, initialRetryDelayMs, multiplier, jitterFactor, dependencies) {\n        if (dependencies === void 0) { dependencies = {\n            setTimeout: setTimeoutWrapper,\n            clearTimeout: clearTimeoutWrapper\n        }; }\n        this._maxRetryTimeMs = _valueOrDefault(maxRetryTimeMs, DEFAULT_MAX_RETRY_TIME_MS);\n        this._initialRetryDelayMs = _valueOrDefault(initialRetryDelayMs, DEFAULT_INITIAL_RETRY_DELAY_MS);\n        this._multiplier = _valueOrDefault(multiplier, DEFAULT_RETRY_DELAY_MULTIPLIER);\n        this._jitterFactor = _valueOrDefault(jitterFactor, DEFAULT_RETRY_DELAY_JITTER_FACTOR);\n        this._setTimeout = dependencies.setTimeout;\n        this._clearTimeout = dependencies.clearTimeout;\n        this._inFlightTimeoutIds = [];\n        this.pipelineBegin = false;\n        this.telemetryApi = constants_1.TELEMETRY_APIS.MANAGED_TRANSACTION;\n        this._verifyAfterConstruction();\n    }\n    TransactionExecutor.prototype.execute = function (transactionCreator, transactionWork, transactionWrapper) {\n        var _this = this;\n        var context = {\n            apiTransactionConfig: {\n                api: this.telemetryApi,\n                onTelemetrySuccess: function () {\n                    context.apiTransactionConfig = undefined;\n                }\n            }\n        };\n        return new Promise(function (resolve, reject) {\n            _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, context).catch(reject);\n        }).catch(function (error) {\n            var retryStartTimeMs = Date.now();\n            var retryDelayMs = _this._initialRetryDelayMs;\n            return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTimeMs, retryDelayMs, transactionWrapper, context);\n        });\n    };\n    TransactionExecutor.prototype.close = function () {\n        var _this = this;\n        // cancel all existing timeouts to prevent further retries\n        this._inFlightTimeoutIds.forEach(function (timeoutId) { return _this._clearTimeout(timeoutId); });\n        this._inFlightTimeoutIds = [];\n    };\n    TransactionExecutor.prototype._retryTransactionPromise = function (transactionCreator, transactionWork, error, retryStartTime, retryDelayMs, transactionWrapper, executionContext) {\n        var _this = this;\n        var elapsedTimeMs = Date.now() - retryStartTime;\n        if (elapsedTimeMs > this._maxRetryTimeMs || !(0, error_1.isRetriableError)(error)) {\n            return Promise.reject(error);\n        }\n        return new Promise(function (resolve, reject) {\n            var nextRetryTime = _this._computeDelayWithJitter(retryDelayMs);\n            var timeoutId = _this._setTimeout(function () {\n                // filter out this timeoutId when time has come and function is being executed\n                _this._inFlightTimeoutIds = _this._inFlightTimeoutIds.filter(function (id) { return id !== timeoutId; });\n                _this._executeTransactionInsidePromise(transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext).catch(reject);\n            }, nextRetryTime);\n            // add newly created timeoutId to the list of all in-flight timeouts\n            _this._inFlightTimeoutIds.push(timeoutId);\n        }).catch(function (error) {\n            var nextRetryDelayMs = retryDelayMs * _this._multiplier;\n            return _this._retryTransactionPromise(transactionCreator, transactionWork, error, retryStartTime, nextRetryDelayMs, transactionWrapper, executionContext);\n        });\n    };\n    TransactionExecutor.prototype._executeTransactionInsidePromise = function (transactionCreator, transactionWork, resolve, reject, transactionWrapper, executionContext) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tx, txPromise, _a, error_2, wrap, wrappedTx, resultPromise;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 4, , 5]);\n                        txPromise = transactionCreator((executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) != null\n                            ? __assign({}, executionContext === null || executionContext === void 0 ? void 0 : executionContext.apiTransactionConfig) : undefined);\n                        if (!this.pipelineBegin) return [3 /*break*/, 1];\n                        _a = txPromise;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, txPromise];\n                    case 2:\n                        _a = _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        tx = _a;\n                        return [3 /*break*/, 5];\n                    case 4:\n                        error_2 = _b.sent();\n                        // failed to create a transaction\n                        reject(error_2);\n                        return [2 /*return*/];\n                    case 5:\n                        wrap = transactionWrapper !== null && transactionWrapper !== void 0 ? transactionWrapper : (function (tx) { return tx; });\n                        wrappedTx = wrap(tx);\n                        resultPromise = this._safeExecuteTransactionWork(wrappedTx, transactionWork);\n                        resultPromise\n                            .then(function (result) {\n                            return _this._handleTransactionWorkSuccess(result, tx, resolve, reject);\n                        })\n                            .catch(function (error) { return _this._handleTransactionWorkFailure(error, tx, reject); });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    TransactionExecutor.prototype._safeExecuteTransactionWork = function (tx, transactionWork) {\n        try {\n            var result = transactionWork(tx);\n            // user defined callback is supposed to return a promise, but it might not; so to protect against an\n            // incorrect API usage we wrap the returned value with a resolved promise; this is effectively a\n            // validation step without type checks\n            return Promise.resolve(result);\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    };\n    TransactionExecutor.prototype._handleTransactionWorkSuccess = function (result, tx, resolve, reject) {\n        if (tx.isOpen()) {\n            // transaction work returned resolved promise and transaction has not been committed/rolled back\n            // try to commit the transaction\n            tx.commit()\n                .then(function () {\n                // transaction was committed, return result to the user\n                resolve(result);\n            })\n                .catch(function (error) {\n                // transaction failed to commit, propagate the failure\n                reject(error);\n            });\n        }\n        else {\n            // transaction work returned resolved promise and transaction is already committed/rolled back\n            // return the result returned by given transaction work\n            resolve(result);\n        }\n    };\n    TransactionExecutor.prototype._handleTransactionWorkFailure = function (error, tx, reject) {\n        if (tx.isOpen()) {\n            // transaction work failed and the transaction is still open, roll it back and propagate the failure\n            tx.rollback()\n                .catch(function (ignore) {\n                // ignore the rollback error\n            })\n                .then(function () { return reject(error); }) // propagate the original error we got from the transaction work\n                .catch(reject);\n        }\n        else {\n            // transaction is already rolled back, propagate the error\n            reject(error);\n        }\n    };\n    TransactionExecutor.prototype._computeDelayWithJitter = function (delayMs) {\n        var jitter = delayMs * this._jitterFactor;\n        var min = delayMs - jitter;\n        var max = delayMs + jitter;\n        return Math.random() * (max - min) + min;\n    };\n    TransactionExecutor.prototype._verifyAfterConstruction = function () {\n        if (this._maxRetryTimeMs < 0) {\n            throw (0, error_1.newError)('Max retry time should be >= 0: ' + this._maxRetryTimeMs.toString());\n        }\n        if (this._initialRetryDelayMs < 0) {\n            throw (0, error_1.newError)('Initial retry delay should >= 0: ' + this._initialRetryDelayMs.toString());\n        }\n        if (this._multiplier < 1.0) {\n            throw (0, error_1.newError)('Multiplier should be >= 1.0: ' + this._multiplier.toString());\n        }\n        if (this._jitterFactor < 0 || this._jitterFactor > 1) {\n            throw (0, error_1.newError)('Jitter factor should be in [0.0, 1.0]: ' + this._jitterFactor.toFixed());\n        }\n    };\n    return TransactionExecutor;\n}());\nexports.TransactionExecutor = TransactionExecutor;\nfunction _valueOrDefault(value, defaultValue) {\n    if (value != null) {\n        return value;\n    }\n    return defaultValue;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script"}